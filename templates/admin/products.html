<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products Management - Deli Spi Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>
<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>Deli Spi Admin</h2>
            </div>
            <ul class="sidebar-menu">
                <li><a href="{{ url_for('admin.dashboard') }}"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
                <li><a href="{{ url_for('admin.products') }}" class="active"><i class="fas fa-box"></i> <span>Products</span></a></li>
                <li><a href="{{ url_for('admin.orders') }}"><i class="fas fa-shopping-cart"></i> <span>Orders</span></a></li>
                <li><a href="{{ url_for('admin.customers') }}"><i class="fas fa-users"></i> <span>Customers</span></a></li>
                <li><a href="{{ url_for('main.index') }}"><i class="fas fa-external-link-alt"></i> <span>View Site</span></a></li>
                <li><a href="{{ url_for('auth.logout') }}"><i class="fas fa-sign-out-alt"></i> <span>Logout</span></a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>Products Management</h1>
                <button class="btn btn-primary" onclick="showAddProductModal()">
                    <i class="fas fa-plus"></i>
                    Add New Product
                </button>
            </div>

            <!-- Products Table -->
            <div class="table-container">
                <div class="table-header">
                    <h2 class="table-title">All Products</h2>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Image</th>
                            <th>Name</th>
                            <th>Category</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for product in products %}
                        <tr>
                            <td>
                                {% if product.image %}
                                    {% if product.image.startswith('http') %}
                                        <img src="{{ product.image }}" alt="{{ product.name }}" class="product-image">
                                    {% else %}
                                        <img src="{{ url_for('static', filename=product.image.lstrip('/')) }}" alt="{{ product.name }}" class="product-image">
                                    {% endif %}
                                {% else %}
                                    <div class="product-image" style="background-color: #f0f0f0; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-image" style="color: #ccc;"></i>
                                    </div>
                                {% endif %}
                            </td>
                            <td>{{ product.name }}</td>
                            <td>{{ product.category.name }}</td>
                            <td>â‚¹{{ "%.2f"|format(product.price) }}</td>
                            <td>{{ product.stock_quantity }}</td>
                            <td>
                                <span class="status-badge status-{{ product.status }}">
                                    {{ product.status.title() }}
                                </span>
                            </td>
                            <td>
                                <button class="action-btn edit-btn" onclick="editProduct({{ product.id }})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteProduct({{ product.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                                {% if product.status == 'inactive' %}
                                <button class="action-btn reactivate-btn" onclick="reactivateProduct({{ product.id }})" style="background-color: #28a745; color: white;">
                                    <i class="fas fa-undo"></i> Reactivate
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Product</h2>
                <span class="close-modal" onclick="closeAddProductModal()">&times;</span>
            </div>
            <form method="POST" action="{{ url_for('admin.new_product') }}">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{ form.name.label(class="form-label") }}
                    {{ form.name(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.category.label(class="form-label") }}
                    {{ form.category(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.price.label(class="form-label") }}
                    {{ form.price(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.stock_quantity.label(class="form-label") }}
                    {{ form.stock_quantity(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.sku.label(class="form-label") }}
                    {{ form.sku(class="form-control") }}
                </div>
                <div class="form-group">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control", rows="4") }}
                </div>
                <div class="form-group">
                    {{ form.image.label(class="form-label") }}
                    {{ form.image(class="form-control") }}
                </div>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn btn-secondary" onclick="closeAddProductModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function showAddProductModal() {
            document.getElementById('addProductModal').style.display = 'block';
        }

        function closeAddProductModal() {
            document.getElementById('addProductModal').style.display = 'none';
        }

        function editProduct(productId) {
            window.location.href = `/admin/products/${productId}/edit`;
        }

        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                fetch(`/admin/products/${productId}/delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error deleting product');
                    }
                });
            }
        }

        function reactivateProduct(productId) {
            if (confirm('Are you sure you want to reactivate this product?')) {
                fetch(`/admin/products/${productId}/reactivate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    } else {
                        alert('Error reactivating product');
                    }
                });
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('addProductModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>